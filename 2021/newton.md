\chapter{探索アルゴリズム}

コンピュータ・アルゴリズムの基本的な考え方である探索をみていこう。

## 全探索

まず、コンピュータが得意な問題を考えてみましょう。

\begin{lbox}{４つの整数の和(課題(129) Sum of 4 Integers)}
0~9 の範囲の整数 a,b,c,d の組で
を満たすものの組み合わせ数を出力するプログラムを作成して下さい。
\[
a+b+c+d=n
\]
例: n が 35 のとき、(a,b,c,d) の組み合わせは (8,9,9,9)、(9,8,9,9)、(9,9,8,9)、(9,9,9,8) の 4 通り
\end{lbox}

コンピュータは、全ての組み合わせを計算することは得意です。

```py
count = 0
for a in range(0, 10):
for b in range(0, 10):
for c in range(0, 10):
for d in range(0, 10):
if a+b+c+d == n:
count +=1
print(count)
```

データ列（今回の場合は、$(a,b,c,d)$の組み合わせ)から、答えを探すことを**探索**{search}と言います。
今回のように探索範囲を狭めることなく、全てのデータ列を調べることを**全探索**と呼びます。
全探索は、どのような問題も解くことができる強力な手段ですが、探索範囲が大きくなると時間がかかります。
だから、探索範囲を効率よく狭めることがアルゴリズムのポイントになります。


\if0
## 年齢当てゲーム

A さんの年齢を当てようとしています。
A さんが、20 歳以上 36 歳未満だというのはわかっているとしましょう。
あなたは A さんに 4 回だけ Yes / No で答えられる質問をすることができます。
A さんの年齢を当てられるでしょうか？？？
\fi

## 平方根の計算

探索が様々な問題に応用できるところをみていきましょう。

\begin{lbox}{平方根を求める}
$n$の平方根(square root, $\sqrt{n}$)を求めよ。
\end{lbox}

最初の情報レシピでも見た通り、平方根の解法は色々存在します。
より一般化すると、次の方程式の解を求める問題と等しくなります。

\[
f(x) = x^2 - n = 0
\]

ここで、２次方程式の解の公式を当てはめるのではなく、
探索問題，つまり**$f(x) = 0$となる$x$を探す問題**として解きます。

\begin{center}
\includegraphics[width=8cm]{figs/fxsearch.pdf}\\
探索： x の値を変化させながら、f(x)=0を探す
\end{center}

### 実用的でない方法

解$x$は$0 \le x < n$なので、$x = 0.0$から、少しずつ$x$を増やしながら、
$f(x) = 0$になるまで$x$を探してみます。

```py
DELTA = 0.001
def sqrt(n):
x = 0.0
while x < n:
if abs(x**2 - n) < 0.0001:
return x
x += DELTA
```

DELTA は、計算の精度になります。
小さくすると、精度はあがりますが、探索空間は広くなります。

xは浮動小数点数なので、
幸運でもない限り、整数のようにぴったりと等号が成り立ちません。
そこで、絶対値をとって充分に近ければ等しいこととみなしています。


**等号？**
```py
x**2 - n == 0
```


**近似**
```py
abs(x**2 - n) <= 0.00001
```



### 二分探索

二分探索は、探索空間を半分に分割して、解の存在する空間だけ調べていく方法です。

方程式の解は、**中間値の定理**を用いることで、
区間[a,b]の中間値から、どちらに解があるか判定し、
探索範囲を狭めることができます。\\

%探索範囲を狭める方法が必要となります。

\begin{tabular}{cc}
\begin{minipage}{0.3\hsize}
\begin{center}
\includegraphics[width=3cm]{figs/qbrt.pdf}
\end{center}
\end{minipage}
%\end{figure}
&
\begin{minipage}{0.6\hsize}
中間値の定理とは, $f(x) = 0$となる$x$解は，$x_a < x < x_b$にあるとき，
ここで，$x_a, x_b$の中間値$x_m$:
\[
x_m = \frac{x_a + x_b}{2}
\]
に対して，$f(x_a)$と$f(x_m)$が同じ符号なら$x_m < x < x_b$, $f(x_b)$と$f(x_m)$が同じ符号なら$x_a < x < x_m$が成り立つ。
\end{minipage}
\end{tabular}\\

\begin{lbox}{ポイント}
解が見つかるまで、**繰り返し**て探索範囲を狭めることです。
繰り返すことで、高々数十回の探索で精度のよい解にたどり着けます。
\end{lbox}


二分探索は、次のように再帰関数を使って書くと、書きやすいです。

```py
def sqrt(n, a=0, b=n):
#中間値を計算する
m = (a + b) / 2

if abs(m**2-n) <= 0.000001:
return m

if (a**2-n) * (m**2-n) < 0:
# m より左側に解がある
return sqrt(n, a, m)
else:
# m より右側に解がある
return sqrt(n, m, b)

```

### Newton-Raphson 法

%２分法は，あとの章で登場する\Google{２分探索}とも通じる定番の効率のよい探索方法です。
方程式の求解アルゴリズムとしては，\Google{Newton-Raphson 法}など，より収束効率が優れたものが存在します。
そちらも調べてみよう。

\begin{center}
\includegraphics[width=8cm]{figs/newton.pdf}\\
Newton-Raphson 法による解析解
\end{center}

\if0
\section*{本日の課題}

\HBold{課題（平方根）}
$\sqrt{n}$を二分法とNewton-Raphson 法で求めよ。
そのとき、収束の効率良さを$f(x)$を何回計算したかをカウントして比較せよ。
また、二分法とNewton-Raphson 法を比較し、それぞれの利点・欠点をまとめよ。

\fi
